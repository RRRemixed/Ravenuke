<?php 
header("Content-type: image/png"); 

$id = $_GET['id'];

include ("../../config.php");

mysql_connect($dbhost, $dbuname, $dbpass);
mysql_select_db($dbname);

$result = mysql_query("SELECT * FROM ".$prefix."_users");
$numusers = mysql_num_rows($result);

$theresult = mysql_query("SELECT username FROM ".$prefix."_users ORDER BY `user_id` DESC LIMIT 1"); 
list($lastuser) = mysql_fetch_row($theresult); 

$resultt = mysql_query("SELECT count FROM ".$prefix."_counter WHERE type='total' AND var='hits'");
$count_holder = sprintf("%05d", implode(mysql_fetch_row($resultt)));

$sql = mysql_query("SELECT uname FROM ".$prefix."_session WHERE guest=1");
$guestson = mysql_num_rows($sql);

$sql = mysql_query("SELECT uname FROM ".$prefix."_session WHERE guest=0");
$memson = mysql_num_rows($sql);

function commify ($str) { 
        $n = strlen($str); 
        if ($n <= 3) { 
                $return=$str;
        } 
        else { 
                $pre=substr($str,0,$n-3); 
                $post=substr($str,$n-3,3); 
                $pre=commify($pre); 
                $return="$pre,$post"; 
        }
        return($return); 
}

$numusers = commify($numusers);
$count_holder = commify($count_holder);

$Today = getdate();
$month = $Today['month'];
$mday = $Today['mday'];
$year = $Today['year'];
$pmonth = $Today['month'];
$pmday = $Today['mday'];
$pmday = $mday-1;
$pyear = $Today['year'];
if ($pmonth=="January") { $pmonth=1; } else
if ($pmonth=="February") { $pmonth=2; } else
if ($pmonth=="March") { $pmonth=3; } else
if ($pmonth=="April") { $pmonth=4; } else
if ($pmonth=="May") { $pmonth=5; } else
if ($pmonth=="June") { $pmonth=6; } else
if ($pmonth=="July") { $pmonth=7; } else
if ($pmonth=="August") { $pmonth=8; } else
if ($pmonth=="September") { $pmonth=9; } else
if ($pmonth=="October") { $pmonth=10; } else
if ($pmonth=="November") { $pmonth=11; } else
if ($pmonth=="December") { $pmonth=12; };
$test = mktime (0,0,0,$pmonth,$pmday,$pyear,1);
$curDate = "%".$month[0].$month[1].$month[2]."%".$mday."%".$year."%";
$sql = mysql_query("SELECT COUNT(user_id) AS userCount FROM ".$user_prefix."_users WHERE user_regdate LIKE '$curDate'");
$tom = mysql_fetch_array($sql);
$tomem = $tom[userCount];

$sql = mysql_query("SELECT sitename FROM ".$prefix."_config");
$sitename = mysql_fetch_array($sql);
$sitename = $sitename[sitename];

$text = $sitename;
$text0 = "Current Members: $numusers";
$text1 = "Newst Member: $lastuser";
$text2 = "Todays Members: $tomem";
$text3 = "Guests Online: $guestson";
$text4 = "Members Online: $memson";
$text5 = "Total Hits: $count_holder";

$image = imagecreatefrompng("bg0.png");

$font = "verdana.ttf";
$fontbold = "verdanab.ttf";

$clr_white = imagecolorallocate($image, 0, 0, 0); 
$clr_title = imagecolorallocate($image, 200, 202, 12); 

// Add the text
imagettftext ($image, 9, 0, 5, 15, $clr_title, $fontbold, $text);
imagettftext ($image, 8, 0, 5, 30, $clr_white, $font, $text0);
imagettftext ($image, 8, 0, 5, 45, $clr_white, $font, $text1);
imagettftext ($image, 8, 0, 5, 60, $clr_white, $font, $text2);
imagettftext ($image, 8, 0, 200, 30, $clr_white, $font, $text3);
imagettftext ($image, 8, 0, 200, 45, $clr_white, $font, $text4);
imagettftext ($image, 8, 0, 200, 60, $clr_white, $font, $text5);

// and now we display the image 
imagepng($image); 
imagedestroy($image);
?>
